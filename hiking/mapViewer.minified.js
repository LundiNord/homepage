import{getStandardLeafletMap}from"./hiking.js";const bigMap=getStandardLeafletMap("big-map");function addMarker(e){new L.marker(e).addTo(bigMap)}bigMap.setView([50,10],3),L.control.locate().addTo(bigMap);let curentLocation=null;bigMap.on("locationfound",(function(e){curentLocation=e.latlng}));const search=document.getElementById("map-search");search.addEventListener("keyup",(function(){const e=search.value;doLocationSearch(e,0),umami.track("Location Search",{search_data:e})}));const searchResults=document.getElementById("map-search-results"),searchApiUrl="https://api.mapbox.com/search/geocode/v6/forward",mapboxToken="pk.eyJ1Ijoibnl4bm9yZCIsImEiOiJjbTdkZDZoeGswMXpkMmlzYjZzYnNuMGthIn0.bHJF97xa3uu3Vr4xj4tgWQ";async function doLocationSearch(e,t){if(e.length<2){let e=1===t?routeStartResults:2===t?routeEndResults:searchResults;return e.innerHTML="",void(e.style.display="none")}fetch(`${searchApiUrl}?q=${e}&proximity=ip&autocomplete=true&access_token=${mapboxToken}`).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{1===t||2===t?showRoutePointSearch(e,t):showSearchResults(e)})).catch((e=>{console.error("Error:",e)}))}function showSearchResults(e){searchResults.innerHTML="",searchResults.style.display="block",e.features.forEach((e=>{const t=document.createElement("div");t.textContent=e.properties.name+", "+e.properties.full_address,t.textContent=t.textContent+"\n",t.style.cursor="pointer",t.addEventListener("click",(()=>{const t=e.geometry.coordinates;bigMap.setView([t[1],t[0]],15),addMarker([t[1],t[0]])})),searchResults.appendChild(t);const o=document.createElement("div");o.innerHTML="------------",searchResults.appendChild(o)})),searchResults.removeChild(searchResults.lastChild)}let startCoords=null,endCoords=null;const routeStart=document.getElementById("route-start-search");routeStart.addEventListener("keyup",(function(){const e=routeStart.value;doLocationSearch(e,1),umami.track("Route Start Search",{search_data:e})}));const routeStartResults=document.getElementById("route-start-results"),routeEnd=document.getElementById("route-end-search");routeEnd.addEventListener("keyup",(function(){const e=routeEnd.value;doLocationSearch(e,2),umami.track("Route End Search",{search_data:e})}));const routeEndResults=document.getElementById("route-end-results"),calcRouteButton=document.getElementById("route-button");function showRoutePointSearch(e,t){let o=1===t?routeStartResults:routeEndResults;o.innerHTML="",o.style.display="block",e.features.forEach((e=>{const n=document.createElement("div");n.textContent=e.properties.name+", "+e.properties.full_address,n.textContent=n.textContent+"\n",n.style.cursor="pointer",n.addEventListener("click",(()=>{const n=e.geometry.coordinates;addMarker([n[1],n[0]]),o.innerHTML="",o.style.display="none",1===t?(startCoords=n,routeStart.value=e.properties.name):(endCoords=n,routeEnd.value=e.properties.name)})),o.appendChild(n);const r=document.createElement("div");r.innerHTML="------------",o.appendChild(r)})),o.removeChild(o.lastChild)}function calcRoute(){if(null==startCoords||null==endCoords)return;let e=`https://api.mapbox.com/directions/v5/mapbox/walking/${startCoords[0]},${startCoords[1]};${endCoords[0]},${endCoords[1]}?alternatives=false&geometries=geojson&language=en&overview=simplified&steps=true&access_token=${mapboxToken}`;fetch(e).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{showRoute(e)})).catch((e=>{console.error("Error:",e)})),umami.track("Route Calculated")}function showRoute(e){document.getElementById("route-info").style.display="block";let t=L.geoJSON(e.routes[0].geometry).addTo(bigMap);bigMap.fitBounds(t.getBounds());document.getElementById("route-stats").innerHTML="Duration: "+Math.round(e.routes[0].duration/60)+" min\n Distance: "+Math.round(e.routes[0].distance/1e3)+" km";const o=document.getElementById("route-instructions"),n=e.routes[0].legs[0].steps;let r="";for(const e of n)r+=`<li>${e.maneuver.instruction} for ${Math.round(e.distance/1e3*10)/10} km</li>`;o.innerHTML=`<ol>${r}</ol>`}calcRouteButton.addEventListener("click",calcRoute);