!function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(L)}((function(t){t.Measure={linearMeasurement:"Distance measurement",areaMeasurement:"Area measurement",start:"Start",meter:"m",meterDecimals:0,kilometer:"km",kilometerDecimals:2,squareMeter:"m²",squareMeterDecimals:0,squareKilometers:"km²",squareKilometersDecimals:2},t.Control.Measure=t.Control.extend({options:{position:"topright",title:"Measurement",collapsed:!0,color:"#FF0080"},initialize:function(e){t.Util.setOptions(this,e)},onAdd:function(t){return this._map=t,this._container||this._initLayout(),this._container},_buildContainer:function(){(this._container=t.DomUtil.create("div","leaflet-control-measure leaflet-bar leaflet-control"),this._contents=t.DomUtil.create("div","leaflet-measure-contents",this._container),this._link=t.DomUtil.create("a","leaflet-measure-toggle",this._container),this._link.title=this.options.title||"Measurement",this._link.href="#",this.options.title)&&(t.DomUtil.create("h3","",this._contents).innerText=this.options.title);this._buildItems()},_buildItems:function(){var e=t.DomUtil.create("ul","leaflet-measure-actions",this._contents),i=t.DomUtil.create("li","leaflet-measure-action",e),a=t.DomUtil.create("a","start",i);a.innerText=t.Measure.linearMeasurement,a.href="#",t.DomEvent.disableClickPropagation(a),t.DomEvent.on(a,"click",this._enableMeasureLine,this),i=t.DomUtil.create("li","leaflet-measure-action",e);var s=t.DomUtil.create("a","leaflet-measure-action start",i);s.innerText=t.Measure.areaMeasurement,s.href="#",t.DomEvent.disableClickPropagation(s),t.DomEvent.on(s,"click",this._enableMeasureArea,this)},_initLayout:function(){this._buildContainer(),t.DomEvent.disableClickPropagation(this._container),t.DomEvent.disableScrollPropagation(this._container),this.options.collapsed?t.DomEvent.on(this._container,{mouseenter:this._expand,mouseleave:this._collapse},this):this._expand()},_enableMeasureLine:function(e){t.DomEvent.stopPropagation(e),t.DomEvent.preventDefault(e),this._measureHandler=new t.MeasureAction(this._map,{model:"distance",color:this.options.color}),this._measureHandler.enable()},_enableMeasureArea:function(e){t.DomEvent.stopPropagation(e),t.DomEvent.preventDefault(e),this._measureHandler=new t.MeasureAction(this._map,{model:"area",color:this.options.color}),this._measureHandler.enable()},_expand:function(){return this._link.style.display="none",t.DomUtil.addClass(this._container,"leaflet-measure-expanded"),this},_collapse:function(){return this._link.style.display="block",t.DomUtil.removeClass(this._container,"leaflet-measure-expanded"),this}}),t.control.measure=t.control.Measure=function(e){return new t.Control.Measure(e)},t.MeasureLable=t.Layer.extend({options:{offset:new t.Point(0,30),latlng:null,content:"",className:""},initialize:function(e){t.Util.setOptions(this,e)},onAdd:function(e){this._map=e,this._container||this._initLayout(),e._panes.popupPane.appendChild(this._container),e.on("viewreset",this._updatePosition,this),t.Browser.any3d&&e.on("zoomanim",this._zoomAnimation,this),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),t.off({viewreset:this._updatePosition,zoomanim:this._zoomAnimation},this),this._map=null},setLatLng:function(e){return this.options.latlng=t.latLng(e),this._updatePosition(),this},setContent:function(t){return this.options.content=t,this._updateContent(),this},_initLayout:function(){this._container=t.DomUtil.create("div",this.options.className),this._contentNode=t.DomUtil.create("div","content",this._container)},_update:function(){this._map&&(this._updateContent(),this._updatePosition())},_updateContent:function(){this.options.content&&("string"==typeof this.options.content?this._contentNode.innerHTML=this.options.content:(this._contentNode.innerHTML="",this._contentNode.appendChild(this.options.content)))},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this.options.latlng),i=t.Browser.any3d,a=this.options.offset;i&&t.DomUtil.setPosition(this._container,e),this._containerBottom=-a.y-(i?0:e.y),this._containerLeft=a.x+(i?0:e.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(e){e=this._map._latLngToNewLayerPoint(this.options.latlng,e.zoom,e.center),t.DomUtil.setPosition(this._container,e)},enableClose:function(){return this._closeButton=t.DomUtil.create("span","close",this._container),this._closeButton.innerHTML='<svg class="icon" viewBox="0 0 40 40"><path stroke="#FF0000" stroke-width="3" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg>',this._closeButton}}),t.MeasureAction=t.Handler.extend({options:{color:"#FF0080",model:"distance"},initialize:function(e,i){this._map=e,this._map._measureHandler=this,t.Util.setOptions(this,i)},setModel:function(t){return this.options.model=t,this},addHooks:function(){this._activeMeasure()},removeHooks:function(){},_activeMeasure:function(){this._map._measureHandler._measurementStarted&&this._map._measureHandler._finishMeasure(),this._measurementStarted?this._finishMeasure():this._enableMeasure()},_onMouseClick:function(e){var i=e.latlng||this._map.mouseEventToLatLng(e);if(!this._lastPoint||!i.equals(this._lastPoint)){if(this._trail.points.length>0){var a=this._trail.points;a.push(i);var s=a.length;this._totalDistance+=this._getDistance(a[s-2],a[s-1]),this._addMeasurePoint(i),this._addMarker(i),"area"!==this.options.model&&this._addLable(i,this._getDistanceString(this._totalDistance),"leaflet-measure-lable")}else this._totalDistance=0,this._addMeasurePoint(i),this._addMarker(i),"area"!==this.options.model&&this._addLable(i,t.Measure.start,"leaflet-measure-lable"),this._trail.points.push(i);this._lastPoint=i,this._startMove=!1}},_onMouseMove:function(t){var e=t.latlng;this._trail.points.length>0&&(this._startMove?this._directPath.setLatLngs(this._trail.points.concat(e)):(this._directPath.setLatLngs([e]),this._startMove=!0))},_enableMeasure:function(){var e=this._map;this._trail={points:[],overlays:t.featureGroup(),canvas:e.options.preferCanvas||!1},e.options.preferCanvas&&(e.options.preferCanvas=!1,console.warn("Temporarily reset map.options.prefersCanvas to false")),e.addLayer(this._trail.overlays),t.DomUtil.addClass(e._container,"leaflet-measure-map"),e.contextMenu&&e.contextMenu.disable(),this._measurementStarted=!0,e.on("click",this._onMouseClick,this),e.on("dblclick contextmenu",this._finishMeasure,this),e.doubleClickZoom.disable(),e.on("mousemove",this._onMouseMove,this)},_disableMeasure:function(){var e=this._map;t.DomUtil.removeClass(e.getContainer(),"leaflet-measure-map"),e.contextMenu&&e.contextMenu.enable(),e.off("click",this._onMouseClick,this),e.off("dblclick contextmenu",this._finishMeasure,this),e.off("mousemove",this._onMouseMove,this),e.doubleClickZoom.enable(),this._measurementStarted=this._startMove=!1,this.disable()},_finishMeasure:function(t){this._trail.points.length>0&&(this._trail.points.length>1?(t&&"contextmenu"!==t.type||this._directPath.setLatLngs(this._trail.points),"area"===this.options.model?this._addLable(this._lastPoint,this._getAreaString(this._trail.points),"leaflet-measure-lable",!0):this._addLable(this._lastPoint,this._getDistanceString(this._totalDistance),"leaflet-measure-lable",!0),this._directPath&&this._map.removeLayer(this._directPath)):this._clearOverlay.call(this)),this._disableMeasure()},_resetDirectPath:function(e){this._directPath?this._directPath.addLatLng(e):("area"===this.options.model?this._directPath=new t.Polygon([e],{weight:2,color:this.options.color,dashArray:[5,5],fillOpacity:0,interactive:!1}):this._directPath=new t.Polyline([e],{weight:2,color:this.options.color,dashArray:[5,5],interactive:!1}),this._trail.overlays.addLayer(this._directPath))},_addMeasurePoint:function(e){this._measurePath?this._measurePath.addLatLng(e):("area"===this.options.model?this._measurePath=new t.Polygon([e],{weight:2,color:this.options.color,fillColor:this.options.color,fillOpacity:.5,interactive:!1}):this._measurePath=new t.Polyline([e],{weight:2,color:this.options.color,interactive:!1}),this._trail.overlays.addLayer(this._measurePath)),this._resetDirectPath(e)},_addMarker:function(e){var i=new t.CircleMarker(e,{color:this.options.color,opacity:1,weight:1,fillColor:"#FFFFFF",fill:!0,fillOpacity:1,radius:3,interactive:!1});this._trail.overlays.addLayer(i)},_addLable:function(e,i,a,s){var n=new t.MeasureLable({latlng:e,content:i,className:a});if(this._trail.overlays.addLayer(n),s){var o=n.enableClose();t.DomEvent.on(o,"click",this._clearOverlay,this)}},_clearOverlay:function(){this._map.removeLayer(this._trail.overlays),this._trail.overlays=null,this._map.options.preferCanvas=this._trail.canvas},toRadians:function(t){return t*(Math.PI/180)},square:function(t){return Math.pow(t,2)},_getDistanceString:function(e){return e<1e3?this._numberFormat(e,t.Measure.meterDecimals)+" "+t.Measure.meter:this._numberFormat(e/1e3,t.Measure.kilometerDecimals)+" "+t.Measure.kilometer},_getDistance:function(t,e){var i=this.toRadians(t.lat),a=this.toRadians(e.lat),s=a-i,n=this.toRadians(e.lng-t.lng),o=this.square(Math.sin(s/2))+Math.cos(i)*Math.cos(a)*this.square(Math.sin(n/2));return 12756274*Math.asin(Math.sqrt(o))},_getAreaString:function(e){var i=this._getArea(e);return Math.round(i)<1e6?this._numberFormat(i,t.Measure.squareMeterDecimals)+" "+t.Measure.squareMeter:this._numberFormat(i/1e6,t.Measure.squareKilometersDecimals)+" "+t.Measure.squareKilometers},_getArea:function(t){for(var e=6378137,i=0,a=t.length,s=t[a-1].lng,n=t[a-1].lat,o=0;o<a;o++){var r=t[o].lng,l=t[o].lat;i+=this.toRadians(r-s)*(2+Math.sin(this.toRadians(n))+Math.sin(this.toRadians(l))),s=r,n=l}return Math.abs(i*e*e/2)},_numberFormat:function(t,e=2){var i=t<0?"-":"",a=Math.abs(+t||0),s=parseInt(a.toFixed(e),10)+"",n=s.length>3?s.length%3:0;return[i,n?s.substr(0,n)+",":"",s.substr(n).replace(/(\d{3})(?=\d)/g,"$1,"),e?"."+Math.abs(a-s).toFixed(e).slice(2):""].join("")}}),t.measureAction=function(e,i){return new t.MeasureAction(e,i)}}),window);