const aiWorker=new Worker("ai_worker.minified.js",{type:"module"});aiWorker.onerror=function(e){console.error(e),umami.track("Ai Worker Error",{search_data:e})};let currentResponseDiv=null;async function generateAnswer(){if(isGenerating||!input.value.trim())return;isGenerating=!0;const e=input.value.trim();umami.track("Ai User Message",{message_data:e}),addMessage("user",e),input.value="",currentResponseDiv=addMessage("assistant","Thinking..."),aiWorker.postMessage({message:e,topic:"input"}),setTimeout((()=>{isGenerating=!1}),500)}aiWorker.addEventListener("message",(e=>{const{message:t,topic:s}=e.data;"output"===s?currentResponseDiv&&(currentResponseDiv.textContent=t,chatMessages.scrollTop=chatMessages.scrollHeight):"loaded"===s&&addMessage("assistant","Hello! How can I help you today?")}));const input=document.getElementById("ai_input"),sendButton=document.getElementById("send-button"),chatMessages=document.getElementById("chat-messages"),modelChangeButton=document.getElementById("settings-button"),popup=document.getElementById("settings");let isGenerating=!1;function addMessage(e,t){const s=document.createElement("div");s.className=`chat-message ${e}-message`;const n=document.createElement("span");n.className="avatar",n.textContent="user"===e?"ğŸ‘¤":"ğŸ¤–";const a=document.createElement("div");return a.className="message-content",a.textContent=t,s.appendChild(n),s.appendChild(a),chatMessages.appendChild(s),chatMessages.scrollTop=chatMessages.scrollHeight,a}input.addEventListener("keyup",(function(e){"Enter"===e.key&&(e.preventDefault(),generateAnswer())})),sendButton.addEventListener("click",generateAnswer),modelChangeButton.addEventListener("click",(()=>{popup.style.display=""===popup.style.display||"none"===popup.style.display?"block":"none"})),document.addEventListener("click",(e=>{"block"!==popup.style.display||popup.contains(e.target)||modelChangeButton.contains(e.target)||(popup.style.display="none")})),document.getElementById("model_medium").addEventListener("click",(e=>{aiWorker.postMessage({message:"medium",topic:"model"}),addMessage("assistant","Changing model to SmolLM2-360M-Instruct ..."),popup.style.display="none",umami.track("Set Model",{model_data:"medium"})})),document.getElementById("model_small").addEventListener("click",(e=>{aiWorker.postMessage({message:"small",topic:"model"}),addMessage("assistant","Changing model to SmolLM2-135M-Instruct ..."),popup.style.display="none",umami.track("Set Model",{model_data:"small"})})),document.getElementById("model_big").addEventListener("click",(e=>{aiWorker.postMessage({message:"big",topic:"model"}),addMessage("assistant","Changing model to SmolLM2-1.7B-Instruct ..."),popup.style.display="none",umami.track("Set Model",{model_data:"big"})})),window.addEventListener("DOMContentLoaded",(()=>{0===chatMessages.children.length&&addMessage("assistant","Hi! Go to Settings to choose a model and start chatting.")}));